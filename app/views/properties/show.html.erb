<!-- Property details page -->
<div class="col-lg-4 offset-lg-1" style="margin-left: 60px;">
  <div class="d-flex justify-content-center align-items-center" style="height: 10vh;">
      <h1 class="h2 mb-1"><%= @property.name %></h1>
    </div>
  </div>

<!-- Property Image & Main Details -->
<div class="container mt-1">
  <div class="row">
    <!-- Column 1: Image 1 (Full width on smaller screens) -->
    <div class="col-12 col-md-6 text-center mb-3">
      <a href="#" data-bs-toggle="modal" data-bs-target="#imageModal" data-bs-slide="0">
        <%= image_tag "https://images.pexels.com/photos/1571453/pexels-photo-1571453.jpeg", alt: "Image 1", class: "rounded-img img-fluid", style: "object-fit: cover; width: 100%; height: 450px;" %>
      </a>
    </div>

    <!-- Column 2: Images 2, 3, 4, and 5 in two rows -->
    <div class="col-12 col-md-6">
      <div class="row">
        <!-- Row 1: Image 2 and Image 3 -->
        <div class="col-6 text-center mb-3">
          <a href="#" data-bs-toggle="modal" data-bs-target="#imageModal" data-bs-slide="1">
            <%= image_tag "https://images.pexels.com/photos/1571460/pexels-photo-1571460.jpeg", alt: "Image 2", class: "rounded-img img-fluid", style: "object-fit: cover; width: 110%; height: 220px;" %>
          </a>
        </div>
        <div class="col-6 text-center mb-3">
          <a href="#" data-bs-toggle="modal" data-bs-target="#imageModal" data-bs-slide="2">
            <%= image_tag "https://images.pexels.com/photos/1743227/pexels-photo-1743227.jpeg", alt: "Image 3", class: "rounded-img img-fluid", style: "object-fit: cover; width: 110%; height: 220px;" %>
          </a>
        </div>
      </div>

      <div class="row">
        <!-- Row 2: Image 4 and Image 5 -->
        <div class="col-6 text-center mb-3">
          <a href="#" data-bs-toggle="modal" data-bs-target="#imageModal" data-bs-slide="3">
            <%= image_tag "https://images.pexels.com/photos/1571463/pexels-photo-1571463.jpeg", alt: "Image 4", class: "rounded-img img-fluid", style: "object-fit: cover; width: 110%; height: 220px;" %>
          </a>
        </div>
        <div class="col-6 text-center mb-3">
          <a href="#" data-bs-toggle="modal" data-bs-target="#imageModal" data-bs-slide="4">
            <%= image_tag "https://images.pexels.com/photos/1571450/pexels-photo-1571450.jpeg", alt: "Image 5", class: "rounded-img img-fluid", style: "object-fit: cover; width: 110%; height: 220px;" %>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal for displaying the images -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-body">
        <!-- Image content inside modal -->
        <div id="carouselExample" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner">
            <div class="carousel-item active">
              <% if @property.image.attached? %>
                <%= image_tag @property.image, class: "img-fluid mb-3", alt: @property.name %>
              <% else %>
                <img src="https://via.placeholder.com/500" class="img-fluid mb-3" alt="Default property image">
              <% end %>
            </div>
            <div class="carousel-item active">
              <img src="https://images.pexels.com/photos/1571453/pexels-photo-1571453.jpeg" class="d-block w-100" alt="Image 1" style="object-fit: cover; height: 500px;">
            </div>
            <div class="carousel-item">
              <img src="https://images.pexels.com/photos/1571460/pexels-photo-1571460.jpeg" class="d-block w-100" alt="Image 2" style="object-fit: cover; height: 500px;">
            </div>
            <div class="carousel-item">
              <img src="https://images.pexels.com/photos/1743227/pexels-photo-1743227.jpeg" class="d-block w-100" alt="Image 3" style="object-fit: cover; height: 500px;">
            </div>
            <div class="carousel-item">
              <img src="https://images.pexels.com/photos/1571463/pexels-photo-1571463.jpeg" class="d-block w-100" alt="Image 4" style="object-fit: cover; height: 500px;">
            </div>
            <div class="carousel-item">
              <img src="https://images.pexels.com/photos/1571450/pexels-photo-1571450.jpeg" class="d-block w-100" alt="Image 5" style="object-fit: cover; height: 500px;">
            </div>
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </div>
      <div class="modal-footer">
     <button type="button" class="btn btn-outline-warning text-warning" data-bs-dismiss="modal">Close</button>



      </div>
    </div>
  </div>
</div>




<!-- Property Description & Features -->
<div class="container mt-3">
  <div class="row">
    <!-- Left Column: Property Description -->
    <div class="col-lg-8">
      <h3 class="h4 mb-3">About This Property</h3>
      <% if @property.description.nil? || @property.description.blank? %>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent sit amet ligula id nisi fermentum gravida. Nulla tristique mauris magna, id gravida nisi cursus non. Nam faucibus vehicula ante, vel vehicula sem fermentum vitae. Vivamus condimentum felis a nibh malesuada efficitur.</p>
      <% else %>
        <p><%= @property.description %></p>
      <% end %>

      <!-- Edit and Delete Buttons -->
      <% if current_user == @property.user %>
        <div class="d-flex gap-2 mt-3">
          <%= link_to 'Edit Property', edit_property_path(@property), class: 'btn btn-warning text-white rounded-pill px-4' %>
          <%= button_to 'Delete Property', property_path(@property), method: :delete, class: 'btn btn-danger text-white rounded-pill px-4', data: { confirm: 'Are you sure you want to delete this property?' } %>
        </div>
      <% end %>
    </div>



<!-- Right Column: Booking Form & Button -->
<div class="col-lg-4">
  <div class="card p-3 mb-4">
    <h5 class="h5">Book Your Stay</h5>
    <form>
      <div class="mb-3">
        <label for="checkin" class="form-label">Check-in Date</label>
        <input type="date" class="form-control" id="checkin">
      </div>
      <div class="mb-3">
        <label for="checkout" class="form-label">Check-out Date</label>
        <input type="date" class="form-control" id="checkout">
      </div>
      <div class="mb-3">
        <label for="guests" class="form-label">Number of Guests</label>
        <input type="number" class="form-control" id="guests" min="1" value="1">
      </div>

      <!-- Price Information -->
      <div class="mb-3">
        <p>Price: $<%= @property.price_per_night %> per night</p>
      </div>

      <!-- Button to trigger modal -->
      <button type="button" id="book-now-btn" class="btn btn-warning text-white rounded-pill w-100">Book Now</button>
    </form>
  </div>
</div>


  <!-- Amenities Icons Under the Description -->
  <div class="amenities">
    <div class="col-7">
      <h4 class="h5">Amenities</h4>
      <ul class="list-unstyled row">
        <li class="col-6 mb-2">
          <i class="fas fa-wifi amenities-icon"></i> Free Wi-Fi
        </li>
        <li class="col-6 mb-2">
          <i class="fas fa-paw amenities-icon"></i> Pet-Friendly
        </li>
        <li class="col-6 mb-2">
          <i class="fas fa-swimmer amenities-icon"></i> Swimming Pool
        </li>
        <li class="col-6 mb-2">
          <i class="fas fa-snowflake amenities-icon"></i> Air Conditioning
        </li>
        <li class="col-6 mb-2">
          <i class="fas fa-dumbbell amenities-icon"></i> Gym
        </li>
        <li class="col-6 mb-2">
          <i class="fas fa-car amenities-icon"></i> Free Parking
        </li>
        <li class="col-6 mb-2">
          <i class="fas fa-tv amenities-icon"></i> Smart TV
        </li>
        <li class="col-6 mb-2">
          <i class="fas fa-cocktail amenities-icon"></i> Bar Area
        </li>
         <li class="col-6 mb-2">
          <i class="fas fa-dumbbell amenities-icon"></i> Gym
        </li>
        <li class="col-6 mb-2">
          <i class="fas fa-tshirt amenities-icon"></i> Washer/Dryer
        </li>
        <li class="col-6 mb-2">
          <i class="fas fa-shield-alt amenities-icon"></i> Security
        </li>
         <li class="col-6 mb-2">
          <i class="fas fa-coffee amenities-icon"></i> Coffee Maker
        </li>
        <li class="col-6 mb-2">
          <i class="fas fa-shower amenities-icon"></i> Shower
        </li>
         <li class="col-6 mb-2">
          <i class="fas fa-car amenities-icon"></i> Free Parking
        </li>
        <li class="col-6 mb-2">
          <i class="fas fa-snowflake amenities-icon"></i> Air Conditioning
        </li>
         <li class="col-6 mb-2">
          <i class="fas fa-paw amenities-icon"></i> Pets Allowed
        </li>

      </ul>
    </div>
  </div>
</div>



  <!-- Reviews Section -->
  <div class="mt-5">
    <h3 class="h4">Reviews</h3>
    <div class="row">
      <div class="col-md-6">
        <div class="review-card">
          <div class="d-flex align-items-center mb-3">
            <img src="https://picsum.photos/50/50?random=1" alt="Reviewer" class="rounded-circle me-3">
            <div>
              <p class="fw-bold mb-1">Jane Doe</p>
              <p class="text-muted mb-0">Stayed in December 2024</p>
            </div>
          </div>
          <p>"Wow, this flat was a dream! We stayed for a week and felt completely at home. The apartment was spotless, and the natural light coming in through the big windows made it feel so open and airy. The historic neighborhood was charming with plenty of cafes and shops just around the corner. The host was so welcoming and offered great suggestions for things to do nearby. Highly recommend if you want a cozy, stylish place with a perfect location!"</p>
           <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
        </div>
      </div>

      <div class="col-md-6">
        <div class="review-card">
          <div class="d-flex align-items-center mb-3">
            <img src="https://picsum.photos/50/50?random=2" alt="Reviewer" class="rounded-circle me-3">
            <div>
              <p class="fw-bold mb-1">Will Smith</p>
              <p class="text-muted mb-0">Stayed in December 2024</p>
            </div>
          </div>
          <p>"This apartment is adorable! Perfect for a short getaway or a weekend trip. It’s located in a quiet, peaceful neighborhood but still within walking distance to all the essentials like coffee shops and restaurants. The apartment was spotless, and the decor was really trendy. The host provided excellent recommendations for local spots, and we especially loved the little bookstore down the street. The only reason I didn’t give 5 stars is that the bed was a bit too firm for my liking."</p>
           <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star-half-alt"></i>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        <div class="review-card">
          <div class="d-flex align-items-center mb-3">
            <img src="https://picsum.photos/50/50?random=3" alt="Reviewer" class="rounded-circle me-3">
            <div>
              <p class="fw-bold mb-1">Wanda Sue</p>
              <p class="text-muted mb-0">Stayed in November 2024</p>
            </div>
          </div>
          <p>"The apartment was beautiful, with high-end finishes and stunning views, but we did have some issues. The Wi-Fi was spotty, which made it difficult to work remotely. There was also construction happening nearby during the day, which made it noisy at times. The host was friendly, but we were a little disappointed given the price of the rental. Would consider coming back if some of these issues were addressed."</p>
           <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
        </div>
      </div>

      <div class="col-md-6">
        <div class="review-card">
          <div class="d-flex align-items-center mb-3">
            <img src="https://picsum.photos/50/50?random=4" alt="Reviewer" class="rounded-circle me-3">
            <div>
              <p class="fw-bold mb-1">Walter Benjamin</p>
              <p class="text-muted mb-0">Stayed in Oktober 2024</p>
            </div>
          </div>
          <p>"Such a cozy gem! This studio is perfect for solo travelers or couples looking for a relaxing stay. The space is big and super efficient, with a kitchenette, comfy bed, and even a little garden where you can catch the sunset. The beach is just a short walk away, and there are plenty of cute cafes around the neighborhood. The host was quick to respond to any questions and provided us with beach towels and chairs. Loved this place!"</p>
           <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star-half-alt"></i>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        <div class="review-card">
          <div class="d-flex align-items-center mb-3">
            <img src="https://picsum.photos/50/50?random=5" alt="Reviewer" class="rounded-circle me-3">
            <div>
              <p class="fw-bold mb-1">Simone de Bouvoir</p>
              <p class="text-muted mb-0">Stayed in August 2024</p>
            </div>
          </div>
          <p>"Really stylish apartment with incredible views of the skyline. The loft was well-appointed, and we loved the open-plan layout. The host left us a bottle of wine and some local snacks, which was a nice touch. The only downside was that the apartment was a bit tricky to find at first, and parking was a bit scarce. But overall, we had a great experience, and I would recommend it to anyone looking for a chic place to stay in the city."</p>
           <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
        </div>
      </div>

      <div class="col-md-6">
        <div class="review-card">
          <div class="d-flex align-items-center mb-3">
            <img src="https://picsum.photos/50/50?random=6" alt="Reviewer" class="rounded-circle me-3">
            <div>
              <p class="fw-bold mb-1">Marry Poppins</p>
              <p class="text-muted mb-0">Stayed in June 2024</p>
            </div>
          </div>
          <p>"Fantastic apartment! We stayed here for a week and loved every minute. The apartment is huge, with plenty of space for our family of four. The living room is bright and airy, and the kitchen had everything we needed for cooking. The location was unbeatable – just a short walk to all the main attractions, cafes, and shopping. The host was very accommodating, even providing a list of local hotspots. Would definitely stay here again!"</p>
           <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
        </div>
      </div>



  </div>
  </div>

    <!-- Map Section -->
  <div class="row">
    <div class="col-12">
      <div class="map-container rounded"
        style="width: 100%; height: 600px; border: 1px solid #ddd;"
        data-controller="map"
        data-map-markers-value="<%= @markers.to_json %>"
        data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
      </div>
    </div>
  </div>
</div>

 <!-- Modal structure -->
<div id="booking-modal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>

    <!-- Form with selected dates (initially hidden) -->
    <div id="booking-summary" style="display: none;">
      <h4>Please check your dates and confirm your booking.</h4>
      <p>Check-in: <span id="selected-checkin"></span></p>
      <p>Check-out: <span id="selected-checkout"></span></p>
      <p>Number of Guests: <span id="selected-guests"></span></p>
      <p>Total Price: $<span id="total-price"></span></p> <!-- Display Total Price -->
      <button id="confirm-booking-btn" class="btn btn-success text-white rounded-pill">Confirm Booking</button>
    </div>

    <!-- Booking form (hidden initially) -->
    <div id="booking-form">
      <div class="form-group">
        <label for="checkin-date" class="form-label">Check-in Date</label>
        <input type="date" class="form-control" id="checkin-date">
      </div>
      <div class="form-group">
        <label for="checkout-date" class="form-label">Check-out Date</label>
        <input type="date" class="form-control" id="checkout-date">
      </div>
      <div class="form-group">
        <label for="guests-count" class="form-label">Number of Guests</label>
        <input type="number" class="form-control" id="guests-count" min="1" value="1">
      </div>
      <button id="submit-booking-btn" class="btn btn-warning text-white rounded-pill">Submit Booking</button>
    </div>
  </div>
</div>

<script>
// Open modal when "Book Now" is clicked
document.getElementById("book-now-btn").onclick = function() {
  // Get the selected values
  var checkinDate = document.getElementById("checkin").value;
  var checkoutDate = document.getElementById("checkout").value;
  var guestsCount = document.getElementById("guests").value;
  var pricePerNight = <%= @property.price_per_night %>;  // Make sure this is injected from Ruby

  // Check if the dates are valid
  if (checkinDate && checkoutDate && guestsCount) {
    // Calculate the number of nights
    var checkin = new Date(checkinDate);
    var checkout = new Date(checkoutDate);
    var timeDiff = checkout - checkin;
    var numOfNights = timeDiff / (1000 * 3600 * 24);  // Convert time difference to number of days

    // If the dates are valid (i.e., the checkout is after checkin)
    if (numOfNights > 0) {
      // Calculate the total price
      var totalPrice = numOfNights * pricePerNight;

      // Show the modal
      document.getElementById("booking-modal").style.display = "block";

      // Populate the modal with the selected dates and guest count
      document.getElementById("selected-checkin").textContent = checkinDate;
      document.getElementById("selected-checkout").textContent = checkoutDate;
      document.getElementById("selected-guests").textContent = guestsCount;
      document.getElementById("total-price").textContent = totalPrice.toFixed(2);  // Show the total price

      // Hide the booking form and show the booking summary
      document.getElementById("booking-form").style.display = "none";
      document.getElementById("booking-summary").style.display = "block";
    } else {
      Swal.fire({
        title: 'Error!',
        text: 'Check-out date must be after check-in date.',
        icon: 'error',
        confirmButtonText: 'OK',
        confirmButtonColor: '#dc3545'
      });
    }
  } else {
    Swal.fire({
      title: 'Missing Information!',
      text: 'Please select valid check-in and check-out dates, and the number of guests.',
      icon: 'warning',
      confirmButtonText: 'OK',
      confirmButtonColor: '#ffc107'
    });
  }
};

// Close modal when the close button is clicked
document.querySelector(".close-btn").onclick = function() {
  document.getElementById("booking-modal").style.display = "none";
};

// Confirm booking and show success message using SweetAlert2
document.getElementById("confirm-booking-btn").onclick = function() {
  Swal.fire({
    title: 'Hooray!',
    text: 'Your booking is confirmed. We look forward to hosting you!',
    icon: 'success',
    confirmButtonText: 'OK',
    confirmButtonColor: '#28a745',
    timer: 3000
  });

  // Close the modal after confirming
  document.getElementById("booking-modal").style.display = "none";

  // Optionally, you can submit the booking information to the server here
  // For example, sending an AJAX request with the booking details.
};
</script>

<%= javascript_include_tag 'booking_modal' %> <!-- Include the modal JavaScript -->
